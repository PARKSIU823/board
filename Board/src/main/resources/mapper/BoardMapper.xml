<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.board.mapper.BoardMapper">

	<sql id = "boardColumns">
		  board_idx
		, title
		, content
		, view_count
		, mem_id
		, upt_mem_id
		, del_mem_id
		, insert_time
		, update_time
		, delete_time
		, notice_yn
		, secret_yn
		, delete_yn
	</sql>
	
	<insert id="insertBoard" parameterType="com.board.domain.BoardDTO">
		INSERT INTO TB_BOARD (
			<include refid="boardColumns"/>
		) VALUES (
			  #{boardIdx}
			, #{title}
			, #{content}
			, 0
			, #{memId}
			, NULL
			, NULL
			, NOW()
			, NULL
			, NULL
			, IFNULL(#{noticeYn},'N')
			, IFNULL(#{secretYn},'N')
			, 'N'
		)
	</insert>
	
	<select id="getBoardList" parameterType="com.board.domain.BoardDTO" resultType="com.board.domain.BoardDTO">
		SELECT
			  board_idx
			, title
			, view_count
			, mem_id
			, date_format(insert_time, '%Y-%m-%d') AS insert_time
			, notice_yn
			, secret_yn
		FROM TB_BOARD
		WHERE delete_yn = 'N'
		ORDER BY  notice_yn ASC
				, board_idx DESC
				, insert_time DESC
	</select>
	
	<select id="getBoard" parameterType="int" resultType="com.board.domain.BoardDTO">
		SELECT
			  board_idx
			, title
			, content
			, view_count
			, mem_id
			, date_format(insert_time, '%Y-%m-%d') AS insert_time
			, date_format(update_time, '%Y-%m-%d') AS update_time
			, notice_yn
			, secret_yn
		FROM TB_BOARD
		WHERE board_idx = #{boardIdx}
		AND delete_yn = 'N'
	</select>
	
	<select id="getBoardTotalCount" parameterType="com.board.domain.BoardDTO" resultType="int">
		SELECT count(*) FROM TB_BOARD WHERE delete_yn = 'N'
	</select>
	
	<update id="updateBoard" parameterType="com.board.domain.BoardDTO">
		UPDATE TB_BOARD
		SET
			  title = #{title}
			, content = #{content}
			, upt_mem_id = #{memId}
			, update_time = NOW()
			, notice_yn = IFNULL(#{noticeYn},'N')
			, secret_yn = IFNULL(#{secretYn},'N')
		WHERE board_idx = #{boardIdx}
	</update>
	
	<update id="deleteBoard" parameterType="com.board.domain.BoardDTO">
		UPDATE TB_BOARD
		SET
			  delete_yn = 'Y'
			, del_mem_id = #{memId}
			, delete_time = NOW()
		WHERE board_idx = #{boardIdx}
	</update>
	
	<update id="updateViewCount" parameterType="int">
		UPDATE TB_BOARD
		SET view_count = view_count + 1
		WHERE board_idx = #{boardIdx}
	</update>
</mapper>